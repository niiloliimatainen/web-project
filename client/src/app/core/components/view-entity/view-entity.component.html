<ng-template #loading>
  <mat-spinner color="accent" class="loading-spinner"></mat-spinner>
</ng-template>

<ng-container *ngIf="(this.loading$ | async) === false; else loading">
  <button mat-icon-button class="back-btn" routerLink="/">
    <mat-icon>keyboard_backspace</mat-icon>
  </button>
  <div class="entity-container">
    <div class="entity-headers">
      <h2 class="entity-header">{{ this.entity.title }}</h2>
      <div class="entity-subheaders">
        <div class="user-container">
          <img
            matListAvatar
            class="user-icon"
            [src]="this.coreService.getUserImage(this.entity.userId)"
            onerror="this.src='../../../../assets/placeholder.png';"
            alt="user"
          />
          <p class="username">{{ this.entity.username }}</p>
          <p class="timestamp">{{ this.entity.modified }}</p>
        </div>
        <span class="spacer"></span>
        <app-vote
          [likes]="entity.likes"
          [dislikes]="entity.dislikes"
        ></app-vote>
      </div>
    </div>
    <div class="content-container">
      <div class="text-content">
        <p>
          {{ this.entity.content }}
        </p>
      </div>
      <div>
        <pre><code class="code-content" [highlight]="this.entity.codeSnippet"></code></pre>
      </div>
    </div>
  </div>

  <mat-divider></mat-divider>
  <div class="comment-container">
    <div class="comment-header-container">
      <h2 class="comment-header">
        {{ this.entity.comments?.length }} comments
      </h2>
      <span class="spacer"></span>
      <button
        mat-flat-button
        color="accent"
        class="comment-btn"
        (click)="this.coreService.openAddComment()"
      >
        Add comment
      </button>
    </div>
    <mat-list>
      <app-comment
        *ngFor="let comment of this.comments"
        [comment]="comment"
      ></app-comment>
    </mat-list>
  </div>
</ng-container>
